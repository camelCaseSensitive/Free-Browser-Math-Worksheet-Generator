<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Math Worksheet & Answer Sheet Generator</title>
<style>
  :root {
    --bg: #0b0b0b;
    --panel: #121212;
    --fg: #f3f3f3;
    --muted: #bdbdbd;
    --accent: #4aa3ff;
    --border: #2a2a2a;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0; background: var(--bg); color: var(--fg);
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
  }
  header { padding: 16px 20px 8px; }
  h1 { margin: 0 0 4px; font-size: 20px; }
  .sub { color: var(--muted); font-size: 13px; }

  #controls {
    padding: 12px 20px 18px; display: grid; gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    background: var(--panel); border-top: 1px solid var(--border); border-bottom: 1px solid var(--border);
  }
  .field { display: grid; gap: 6px; }
  .field label { font-size: 13px; color: var(--muted); }
  input[type="number"], select {
    width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border);
    background: #161616; color: var(--fg); font-size: 14px;
  }
  .row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }

  .buttons {
    display: flex; flex-wrap: wrap; gap: 10px; padding: 14px 20px 18px;
    align-items: center;
  }
  button {
    background: var(--accent); border: none; color: white; padding: 10px 14px;
    border-radius: 12px; font-size: 14px; cursor: pointer; font-weight: 600;
  }
  button.secondary { background: #2e2e2e; color: var(--fg); }

  .gallery {
    display: grid; gap: 16px; padding: 16px 20px 40px;
    grid-template-columns: 1fr; max-width: 1100px; margin: 0 auto;
  }
  .imgCard {
    background: var(--panel); border: 1px solid var(--border); border-radius: 14px;
    padding: 14px;
  }
  .imgCard h3 { margin: 0 0 8px; font-size: 16px; }
  .imgWrap {
    background: #fff; border-radius: 8px; overflow: hidden; display: flex;
    justify-content: center; align-items: center;
  }
  .imgWrap img { width: 100%; height: auto; display: block; }

  a.dl {
    text-decoration: none; background: #2e2e2e; color: var(--fg);
    padding: 8px 10px; border-radius: 10px; font-size: 13px;
  }

  @media (min-width: 1000px) { .gallery { grid-template-columns: 1fr 1fr; } }
</style>
</head>
<body>
  <header>
    <h1>Math Worksheet & Answer Sheet Generator</h1>
    <div class="sub">Generate printable vertical-format problems. Exports to PDF.</div>
  </header>

  <section id="controls">
    <div class="field">
      <label>Operation</label>
      <select id="op">
        <option value="+">Addition (+)</option>
        <option value="-">Subtraction (−)</option>
        <option value="×">Multiplication (×)</option>
      </select>
    </div>

    <div class="field">
      <label>Columns</label>
      <input id="cols" type="number" min="1" max="6" value="3" />
    </div>

    <div class="field">
      <label>Problems per column</label>
      <input id="rows" type="number" min="1" max="30" value="10" />
    </div>

    <div class="field">
      <label>Font size (px)</label>
      <input id="fontSize" type="number" min="12" max="72" value="32" />
    </div>

    <div class="field">
      <label>Top number range (min / max)</label>
      <div class="row">
        <input id="topMin" type="number" value="10" />
        <input id="topMax" type="number" value="99" />
      </div>
    </div>

    <div class="field">
      <label>Bottom number range (min / max)</label>
      <div class="row">
        <input id="botMin" type="number" value="10" />
        <input id="botMax" type="number" value="99" />
      </div>
    </div>

    <div class="field">
      <label>Title (optional)</label>
      <input id="title" type="text" placeholder="e.g., Addition Practice" />
    </div>

    <div class="field">
      <label>Paper Size</label>
      <select id="paper">
        <option value="letter" selected>US Letter (8.5×11)</option>
        <option value="a4">A4 (210×297 mm)</option>
      </select>
    </div>
  </section>

  <div class="buttons">
    <button id="genBtn">Generate Worksheet</button>
    <button id="pdfWorksheet" class="secondary">Download PDF — Worksheet Only</button>
    <button id="pdfBoth" class="secondary">Download PDF — Worksheet + Answers</button>
    <span id="status" style="color:var(--muted); font-size:12px;"></span>
  </div>

  <section class="gallery">
    <div class="imgCard">
      <h3>Worksheet Preview</h3>
      <div class="imgWrap"><img id="sheetImg" alt="Worksheet preview" /></div>
      <div style="margin-top:8px; display:flex; gap:10px;">
        <a id="dlSheetPng" class="dl" download="worksheet.png" href="#">Download PNG</a>
      </div>
    </div>

    <div class="imgCard">
      <h3>Answer Sheet Preview</h3>
      <div class="imgWrap"><img id="answersImg" alt="Answer sheet preview" /></div>
      <div style="margin-top:8px; display:flex; gap:10px;">
        <a id="dlAnswersPng" class="dl" download="answers.png" href="#">Download PNG</a>
      </div>
    </div>
  </section>

<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script>
(() => {
  const $ = s => document.querySelector(s);

  const opEl = $('#op'), colsEl = $('#cols'), rowsEl = $('#rows'),
        topMinEl = $('#topMin'), topMaxEl = $('#topMax'),
        botMinEl = $('#botMin'), botMaxEl = $('#botMax'),
        paperEl = $('#paper'), titleEl = $('#title'), fontSizeEl = $('#fontSize');

  const genBtn = $('#genBtn'), pdfWorksheetBtn = $('#pdfWorksheet'),
        pdfBothBtn = $('#pdfBoth'), statusEl = $('#status');

  const sheetImg = $('#sheetImg'), answersImg = $('#answersImg');
  const dlSheetPng = $('#dlSheetPng'), dlAnswersPng = $('#dlAnswersPng');

  const PAPER = {
    letter: { wPx:2550, hPx:3300, wPt:612, hPt:792, key:'letter' },
    a4:     { wPx:2480, hPx:3508, wPt:595.28, hPt:841.89, key:'a4' }
  };

  let lastSheet = '', lastAns = '', lastProblems = [];

  genBtn.onclick = generateAll;
  pdfWorksheetBtn.onclick = () => downloadPDF(false);
  pdfBothBtn.onclick = () => downloadPDF(true);

  function readCfg() {
    return {
      op: opEl.value,
      cols: clamp(int(colsEl.value,3),1,6),
      rows: clamp(int(rowsEl.value,10),1,30),
      fontSize: clamp(int(fontSizeEl.value,32),12,72),
      topMin: int(topMinEl.value,10),
      topMax: int(topMaxEl.value,99),
      botMin: int(botMinEl.value,10),
      botMax: int(botMaxEl.value,99),
      title: titleEl.value.trim(),
      paper: PAPER[paperEl.value] || PAPER.letter,
      nonNegSub: true
    };
  }

  function generateAll() {
    status('');
    const cfg = readCfg();
    if (cfg.topMin > cfg.topMax || cfg.botMin > cfg.botMax) {
      status('Min cannot exceed Max.', true); return;
    }
    const total = cfg.cols * cfg.rows;
    lastProblems = makeProblems(total, cfg);
    const {canvas:ws} = renderPage(lastProblems, cfg, false);
    const {canvas:as} = renderPage(lastProblems, cfg, true);

    lastSheet = ws.toDataURL('image/png');
    lastAns = as.toDataURL('image/png');

    sheetImg.src = lastSheet;
    answersImg.src = lastAns;
    dlSheetPng.href = lastSheet;
    dlAnswersPng.href = lastAns;
  }

  function makeProblems(total, cfg) {
    const {op, topMin, topMax, botMin, botMax, nonNegSub} = cfg;
    const seen = new Set(), arr = [];
    let attempts = 0, maxA = total*50;

    while(arr.length < total && attempts < maxA) {
      attempts++;
      let a = r(topMin, topMax), b = r(botMin, botMax);

      if(op==='-' && nonNegSub && a < b) [a,b] = [b,a];

      let key;
      if(op==='+' || op==='×') {
        const lo=Math.min(a,b), hi=Math.max(a,b);
        key = `${op}:${lo}|${hi}`;
      } else key = `${op}:${a}|${b}`;

      if(seen.has(key)) continue;
      seen.add(key);

      arr.push({top:a, bot:b, op, ans:calc(a,b,op)});
    }

    while(arr.length < total) {
      let a=r(topMin,topMax), b=r(botMin,botMax);
      if(op==='-' && nonNegSub && a<b) [a,b]=[b,a];
      arr.push({top:a,bot:b,op,ans:calc(a,b,op)});
    }
    return arr;
  }

  function calc(a,b,op){ return op==='+'?a+b:op==='-'?a-b:a*b; }

  function renderPage(probs,cfg,withAns){
    const {paper,cols,rows,fontSize,title} = cfg;
    const W=paper.wPx, H=paper.hPx;
    const c=document.createElement('canvas'); c.width=W; c.height=H;
    const g=c.getContext('2d');

    g.fillStyle='#fff'; g.fillRect(0,0,W,H);
    g.fillStyle='#000';

    const margin = Math.round(W*0.06);
    const headerH = Math.round(H*0.11);

    g.font = `${Math.round(headerH*0.18)}px Arial`;
    let yLine = margin + Math.round(headerH*0.55);
    g.fillText('Name: ____________________', margin, yLine);
    const dt='Date: ____________________';
    g.fillText(dt, W-margin-g.measureText(dt).width, yLine);

    g.font = `${Math.round(headerH*0.25)}px Arial`;
    const ttl = title || (withAns?'Answer Sheet':'Math Worksheet');
    g.fillText(ttl,(W-g.measureText(ttl).width)/2, margin+Math.round(headerH*0.2));

    const areaX=margin, areaY=margin+headerH, areaW=W-2*margin, areaH=H-areaY-margin;
    const colW=Math.floor(areaW/cols), rowH=Math.floor(areaH/rows);

    const numFS = fontSize;
    const symFS = fontSize;
    const ansFS = Math.floor(fontSize*0.8);
    const mono='Courier New, Courier, monospace';

    let i=0;
    for(let cIdx=0;cIdx<cols;cIdx++){
      for(let rIdx=0;rIdx<rows;rIdx++){
        if(i>=probs.length) break;
        const p=probs[i++];

        const x0=areaX + cIdx*colW;
        const y0=areaY + rIdx*rowH;

        // Compute max width of the problem block for centering
        g.font = `${numFS}px ${mono}`;
        const topW = g.measureText(String(p.top)).width;
        const botW = g.measureText(String(p.bot)).width;
        const maxW = Math.max(topW, botW) * 1.15;
        const rightX = x0 + (colW / 2) + (maxW / 2); // center alignment
        let currY = y0 + fontSize*1.1; // top aligned

        // Top number
        g.font = `${numFS}px ${mono}`;
        g.textAlign='right';
        g.fillText(String(p.top), rightX, currY);

        // Bottom number width
        g.font = `${numFS}px ${mono}`;
        const botStr = String(p.bot);
        const botWidth = g.measureText(botStr).width;

        // Symbol just left of bottom number
        const botY = currY + fontSize*1.2;
        const gap = fontSize * 0.25;
        g.font = `${symFS}px ${mono}`;
        g.textAlign='left';
        const symX = rightX - botWidth - gap - g.measureText(p.op).width;
        g.fillText(p.op, symX, botY);

        // Bottom number
        g.font = `${numFS}px ${mono}`;
        g.textAlign='right';
        g.fillText(botStr, rightX, botY);

        // Line
        const lineY = botY + fontSize*0.25;
        const lineLeft = rightX - botWidth - gap;
        g.lineWidth = Math.max(2,Math.floor(fontSize*0.08));
        g.beginPath();
        g.moveTo(lineLeft, lineY);
        g.lineTo(rightX, lineY);
        g.stroke();

        // Answer
        if(withAns){
          g.font = `${ansFS}px ${mono}`;
          g.textAlign='right';
          g.fillText(String(p.ans), rightX, lineY + ansFS*1.2);
        }
      }
    }
    return {canvas:c};
  }

  function downloadPDF(includeAns){
    if(!lastSheet){ status('Generate first.',true); return; }
    const cfg=readCfg(); const {jsPDF}=window.jspdf;
    const pdf=new jsPDF({orientation:'portrait',unit:'pt',format:cfg.paper.key});
    const w=pdf.internal.pageSize.getWidth(), h=pdf.internal.pageSize.getHeight();
    pdf.addImage(lastSheet,'PNG',0,0,w,h,'','FAST');
    if(includeAns){
      pdf.addPage(cfg.paper.key,'portrait');
      pdf.addImage(lastAns,'PNG',0,0,w,h,'','FAST');
    }
    const base=(cfg.title||'worksheet').toLowerCase().replace(/\s+/g,'-');
    pdf.save(includeAns?`${base}-with-answers.pdf`:`${base}.pdf`);
  }

  function int(v,d){const n=parseInt(v,10);return Number.isFinite(n)?n:d;}
  function clamp(v,lo,hi){return Math.max(lo,Math.min(hi,v));}
  function r(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
  function status(m,e){statusEl.textContent=m||'';statusEl.style.color=e?'#ff7b7b':'var(--muted)';}

  generateAll();
})();
</script>
</body>
</html>
